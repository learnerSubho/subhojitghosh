{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Portfolio Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

</head>
<body class="bg-gradient-to-br from-purple-100 to-blue-100 min-h-screen font-sans">

  <div class="flex h-screen">

    <!-- Sidebar -->
    <div class="w-64 bg-gradient-to-b from-purple-600 to-blue-600 text-white flex flex-col shadow-lg">
      <div class="text-2xl font-bold text-center py-6 border-b border-white/30">Subhojit Ghosh
        {% if unseen > 0 %}
    <span class="ml-2 inline-block bg-red-600 text-white text-xs font-bold px-2 py-0.5 rounded-full">
      {{ unseen }}
    </span>
    {% endif %}
      </div>
      <nav class="flex-1 p-4 space-y-3">
        <button onclick="showSection('description')" class="w-full text-left px-4 py-2 rounded hover:bg-purple-500 bg-purple-700">📝 Edit Description</button>
        <button onclick="showSection('image')" class="w-full text-left px-4 py-2 rounded hover:bg-purple-500">🖼️ Change Image</button>
        <button onclick="showSection('cv')" class="w-full text-left px-4 py-2 rounded hover:bg-purple-500">📄 Upload CV</button>
        <button onclick="showSection('experience')" class="w-full text-left px-4 py-2 rounded hover:bg-purple-500">💼 Add Experience</button>
        <button onclick="showSection('project')" class="w-full text-left px-4 py-2 rounded hover:bg-purple-500">📊 Add Project</button>
        <button onclick="showSection('blog')" class="w-full text-left px-4 py-2 rounded hover:bg-purple-500">🔖 Add Blog</button>
        <button onclick="showSection('viewmessage')" class="w-full text-left px-4 py-2 rounded hover:bg-purple-500">💬 View Message
          {% if unseen > 0 %}
    <span class="ml-2 inline-block bg-red-600 text-white text-xs font-bold px-2 py-0.5 rounded-full">
      {{ unseen }}
    </span>
  {% endif %}
        </button>
        <button onclick="window.location.href='{% url 'logout' %}'" class="w-full text-left px-4 py-2 rounded hover:bg-purple-500">🔑 Logout</button>


      </nav>
      <div class="text-sm text-center text-white/70 py-4">© 2025 Subhojit Ghosh</div>
    </div>
    {% csrf_token %}
    <!-- Main Content -->
    <div class="flex-1 p-10 overflow-auto">
      <div id="description" class="content-section">
        <h2 class="text-2xl font-semibold mb-4">Edit Front Description</h2>
        <form method="POST" action="{% url 'desc' %}">
          {% csrf_token %}
          <textarea class="w-full h-40 p-4 rounded border border-gray-300 shadow-sm" 
                    name="desc" 
                    placeholder="Enter your portfolio description..."></textarea>
          <button type="submit" 
                  class="mt-4 px-6 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">
            Save Description
          </button>
        </form>
        <div class="mt-6 bg-white p-4 border border-gray-300 rounded shadow-sm">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-semibold text-gray-800">Latest Saved Description</h3>
            
            <form method="POST" action="{% url "delete_desc" %}">
              {% csrf_token %}
              <button type="submit" title="Delete" class="text-red-500 hover:text-red-700">
                <!-- Heroicons Trash Icon -->
                <!-- Heroicons Solid Trash Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor"
                viewBox="0 0 20 20">
                <path fill-rule="evenodd" 
                  d="M6 2a1 1 0 011-1h6a1 1 0 011 1v1h3a1 1 0 110 2h-1v11a2 2 0 
                  01-2 2H5a2 2 0 01-2-2V5H2a1 1 0 110-2h3V2zm2 3a1 1 0 
                  10-2 0v9a1 1 0 102 0V5zm4 0a1 1 0 10-2 0v9a1 1 0 102 0V5z" 
                  clip-rule="evenodd" />
                </svg>

              </button>
            </form>
          </div>
          <p class="text-gray-700 whitespace-pre-line mt-2">{{ current_desc }}</p>
        </div>
        <div class="bg-white p-6 rounded-lg shadow-lg flex flex-col sm:flex-row sm:justify-between items-center">
    <div class="text-center sm:text-left">
      <h2 class="text-2xl font-semibold text-gray-800">📊 Visitor Analytics</h2>
      <p class="text-gray-600 mt-2">Track how many people visited your portfolio.</p>
    </div>
    <div class="mt-4 sm:mt-0 flex space-x-10">
      <div class="text-center">
        <p class="text-3xl font-bold text-blue-600">{{ total_visits }}</p>
        <p class="text-gray-500">Total Visitors</p>
      </div>
      <div class="text-center">
        <p class="text-3xl font-bold text-purple-600">{{ unique_visits }}</p>
        <p class="text-gray-500">Unique Visitors</p>
      </div>
    </div>
  </div>
      </div>

      <div id="image" class="content-section hidden">
        <h2 class="text-2xl font-semibold mb-4">Change Portfolio Image</h2>
        <form method="POST" action="{% url "frontImage" %}" enctype="multipart/form-data">
          {% csrf_token %}
        <input type="file" name="frontimage" class="mb-4"/>
        <a href="{% url 'index' %}#image"><button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Upload Image</button></a>
        </form>
        <div class="mt-6 bg-white p-4 border border-gray-300 rounded shadow-sm">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-semibold text-gray-800">Latest Saved Description</h3>
            
            <form method="POST" action="{% url "delete_frontImage" %}">
              {% csrf_token %}
              <button type="submit" title="Delete" class="text-red-500 hover:text-red-700">
                <!-- Heroicons Trash Icon -->
                <!-- Heroicons Solid Trash Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor"
                viewBox="0 0 20 20">
                <path fill-rule="evenodd" 
                  d="M6 2a1 1 0 011-1h6a1 1 0 011 1v1h3a1 1 0 110 2h-1v11a2 2 0 
                  01-2 2H5a2 2 0 01-2-2V5H2a1 1 0 110-2h3V2zm2 3a1 1 0 
                  10-2 0v9a1 1 0 102 0V5zm4 0a1 1 0 10-2 0v9a1 1 0 102 0V5z" 
                  clip-rule="evenodd" />
                </svg>

              </button>
            </form>
          </div>
          <img src="{{ current_img.photo.url }}" alt="Current Image" style="max-width: 200px; max_height: 200px;" class="mt-4 rounded shadow-sm"/>
        </div>
      </div>








<div id="viewmessage" class="content-section hidden">
  <h2 class="text-2xl font-semibold mb-4">View Message</h2>

  <!-- New Section: All Messages -->
  <div class="mt-6 bg-white p-4 border border-gray-300 rounded shadow-sm">
    <h3 class="text-lg font-semibold text-gray-800 mb-2">All Messages</h3>
    <div class="max-h-60 overflow-y-auto space-y-2">
      {% for message in all_messages %}
        <div class="p-2 border border-gray-200 rounded bg-gray-50">
          {% if message.seen %}
          <p class="text-sm text-green-700 font-bold">{{ message.subject }}</p>
          {% else %}
          <p class="text-sm text-red-700 font-bold">{{ message.subject }}</p>
          {% endif %}
          
          <p style="color: black;" class="text-xs text-gray-400 text-left">{{ message.message }}</p>
          <p class="text-xs text-gray-400 text-right">{{ message.name }}</p>
          <p class="text-xs text-gray-400 text-right">{{ message.date }}</p>

          <!-- Mark as Read Button -->
          <form method="POST" action="{% url "mark_as_seen" message.id %}">
            {% csrf_token %}
            <button type="submit" class="mt-2 text-xs text-blue-600 hover:underline">
              Mark as Read
            </button>
          </form>
        </div>
      {% empty %}
        <p class="text-sm text-gray-500">No messages found.</p>
      {% endfor %}
    </div>
  </div>
</div>

      <div id="cv" class="content-section hidden">
        <h2 class="text-2xl font-semibold mb-4">Upload Your CV</h2>
        <form method="POST" action='{% url "upload_cv" %}' enctype="multipart/form-data">
          {% csrf_token %}
          <input type="file" name="cv_file" accept=".pdf,.doc,.docx" class="block w-full mb-4 p-2 rounded border border-gray-300"/>
          <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Upload CV</button>
        </form>
        <div class="mt-6 bg-white p-4 border border-gray-300 rounded shadow-sm">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-semibold text-gray-800">Latest Uploaded CV</h3>
        
            <form method="POST" action="{% url "delete_cv" %}">
              <!-- CSRF token here -->
               {% csrf_token %}
              <button type="submit" title="Delete CV" class="text-red-500 hover:text-red-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor"
                viewBox="0 0 20 20">
                <path fill-rule="evenodd" 
                  d="M6 2a1 1 0 011-1h6a1 1 0 011 1v1h3a1 1 0 110 2h-1v11a2 2 0 
                  01-2 2H5a2 2 0 01-2-2V5H2a1 1 0 110-2h3V2zm2 3a1 1 0 
                  10-2 0v9a1 1 0 102 0V5zm4 0a1 1 0 10-2 0v9a1 1 0 102 0V5z" 
                  clip-rule="evenodd" />
                </svg>
              </button>
            </form>
          </div>
        
          <div class="mt-4 flex items-center justify-between">
            <p class="text-gray-600">
              📎 {{ filename }}
            </p>
        
            <a href="{% if current_cv %}
            {{current_cv}}
            {% else %}
            #
            {% endif %}" target="_blank" 
               class="text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1">
              📄 View CV
            </a>
          </div>
        </div>
        
      </div>
      <div id="blog" class="content-section hidden">
  <h2 class="text-2xl font-semibold mb-4">Submit Your Blog</h2>
  <form method="POST" action="{% url 'add_blog' %}" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="text" name="headline" placeholder="Blog Headline" class="block w-full mb-4 p-2 rounded border border-gray-300"/>
    <textarea name="body" placeholder="Write your blog body here..." rows="6" class="block w-full mb-4 p-2 rounded border border-gray-300"></textarea>
    <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Submit Blog</button>
  </form>

  <div class="mt-6 bg-white p-4 border border-gray-300 rounded shadow-sm">
    <div class="flex justify-between items-center">
      <h3 class="text-lg font-semibold text-gray-800">Latest Submitted Blog</h3>
      <form method="POST" action="{% url 'delete_cv' %}">
        {% csrf_token %}
        <button type="submit" title="Delete Blog" class="text-red-500 hover:text-red-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" 
              d="M6 2a1 1 0 011-1h6a1 1 0 011 1v1h3a1 1 0 110 2h-1v11a2 2 0 
              01-2 2H5a2 2 0 01-2-2V5H2a1 1 0 110-2h3V2zm2 3a1 1 0 
              10-2 0v9a1 1 0 102 0V5zm4 0a1 1 0 10-2 0v9a1 1 0 102 0V5z" 
              clip-rule="evenodd" />
          </svg>
        </button>
      </form>
    </div>

    <div class="mt-4">
      <table class="min-w-full table-auto border border-gray-300 mt-4">
  <thead class="bg-gray-100">
    <tr>
      <th class="px-4 py-2 border">Headline</th>
      <th class="px-4 py-2 border">Body</th>
      <th class="px-4 py-2 border">Action</th>
    </tr>
  </thead>
  <tbody>
    {% for blog in my_blogs %}
    <tr class="hover:bg-gray-50">
      <td class="px-4 py-2 border font-semibold text-gray-800">📝 {{ blog.headline }}</td>
      <td class="px-4 py-2 border text-gray-600 whitespace-pre-line">{{ blog.body }}</td>
      <td class="py-2 px-4 border-b text-center flex justify-center space-x-2">
                <!-- Edit Button -->
                <a href="">
                <button title="Edit" class="text-blue-600 hover:text-blue-800">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5M18.5 2.5a2.121 2.121 0 113 3L12 15l-4 1 1-4 9.5-9.5z" />
                  </svg>
                </button>
              </a>

                <!-- Delete Button -->
                <a href="{% url "delete_blog" blog.id %}">
                <button title="Delete" class="text-red-600 hover:text-red-800">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0H7m4-3h2a1 1 0 011 1v1H8V5a1 1 0 011-1z" />
                  </svg>
                </button>
              </a>
              </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="3" class="px-4 py-2 border text-center text-gray-500">No blog posts available.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

    </div>
  </div>
</div>

      <div id="experience" class="content-section hidden">
        <h2 class="text-2xl font-semibold mb-4">Add New Work Experience</h2>
        <form method='POST' action='{% url "add_experiences" %}' enctype='multipart/form-data'>
          {% csrf_token %}
        <input type="text" name='company' placeholder="Company Name" class="block w-full mb-2 p-2 rounded border border-gray-300"/>
        <input type="text" name='subject' placeholder="Subject/Role/Title" class="block w-full mb-2 p-2 rounded border border-gray-300"/>
        <input type="text" name='timeline' placeholder="Timeline" class="block w-full mb-2 p-2 rounded border border-gray-300"/>
        <textarea name='desc' placeholder="Description" class="block w-full mb-2 p-2 rounded border border-gray-300"></textarea>
        <button type='submit' class="px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700">Add Experience</button>
      </form>
      <div class="mt-8">
  <h3 class="text-xl font-semibold text-gray-800 mb-4">Published Timeline</h3>

  {% if experiences %}
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white border border-gray-300 rounded shadow-sm">
        <thead class="bg-gray-100 text-gray-700">
          <tr>
            <th class="py-2 px-4 border-b">Company Name</th>
            <th class="py-2 px-4 border-b">Subject/Role</th>
            <th class="py-2 px-4 border-b">Timeline</th>
            <th class="py-2 px-4 border-b">Description</th>
            <th class="py-2 px-4 border-b text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for experience in experiences %}
            <tr class="hover:bg-gray-50">
              <td class="py-2 px-4 border-b">{{ experience.company_name }}</td>
              <td class="py-2 px-4 border-b">{{ experience.subject }}</td>
              <td class="py-2 px-4 border-b">{{ experience.timeline }}</td>
              <td class="py-2 px-4 border-b">{{ experience.desc }}</td>
              <td class="py-2 px-4 border-b text-center flex justify-center space-x-2">
                <!-- Edit Button -->
                <a href="{% url "add_experiences" %}">
                <button title="Edit" class="text-blue-600 hover:text-blue-800">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5M18.5 2.5a2.121 2.121 0 113 3L12 15l-4 1 1-4 9.5-9.5z" />
                  </svg>
                </button>
              </a>

                <!-- Delete Button -->
                <a href="{% url 'delete_experience' experience.id %}">
                <button title="Delete" class="text-red-600 hover:text-red-800">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0H7m4-3h2a1 1 0 011 1v1H8V5a1 1 0 011-1z" />
                  </svg>
                </button>
              </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-gray-500">No experience added yet.</p>
  {% endif %}
</div>

      </div>

      <div id="project" class="content-section hidden">
  <h2 class="text-2xl font-semibold mb-4">Add Project</h2>

  <form method="POST" action="{% url "add_projects" %}" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Client Name -->
    <input type="text" name="project_name" placeholder="Project Title"
           class="block w-full mb-3 p-2 rounded border border-gray-300" required/>

    <!-- Description / Feedback -->
    <textarea name="project_desc" placeholder="Project Description"
              class="block w-full mb-3 p-2 rounded border border-gray-300 h-32" required></textarea>

    <!-- Image Upload -->
    <label class="block mb-1 font-medium text-gray-700">Upload Image</label>
    <input type="file" name="project_image" accept="image/*"
           class="block w-full mb-3 p-2 rounded border border-gray-300" required/>

    <!-- Video Upload -->
    <label class="block mb-1 font-medium text-gray-700">Upload Video</label>
    <input type="file" name="project_video" accept="video/*"
           class="block w-full mb-3 p-2 rounded border border-gray-300" />

    <!-- Project URL -->
    <input type="url" name="project_link" placeholder="Project or Portfolio URL"
           class="block w-full mb-4 p-2 rounded border border-gray-300" />

    <button type="submit"
            class="px-6 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600">
      Submit Project
    </button>
  </form>
  <div class="mt-8">
  <h3 class="text-xl font-semibold text-gray-800 mb-4">Published Timeline</h3>

  {% if projects %}
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white border border-gray-300 rounded shadow-sm">
        <thead class="bg-gray-100 text-gray-700">
          <tr>
            <th class="py-2 px-4 border-b">Project Id</th>
            <th class="py-2 px-4 border-b">Project Title</th>
            <th class="py-2 px-4 border-b">Project Description</th>
            <th class="py-2 px-4 border-b">Project Link</th>
            <th class="py-2 px-4 border-b">Project Image</th>
            <th class="py-2 px-4 border-b">Project Video</th>
            <th class="py-2 px-4 border-b text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for project in projects %}
            <tr class="hover:bg-gray-50">
              <td class="py-2 px-4 border-b">{{ project.id }}</td>
              <td class="py-2 px-4 border-b">{{ project.title }}</td>
              <td class="py-2 px-4 border-b">{{ project.desc }}</td>
              <td class="py-2 px-4 border-b" style="color: blue;"><a href='{{ project.link }}'>Open Link</a></td>
              <td class="py-2 px-4 border-b">
              <a href="#" style="color: blue;" onclick="openImagePopup('{{ project.image.url }}'); return false;">View Image</a>
              </td>
              <td class="py-2 px-4 border-b" style="color: blue;" onclick="openImagePopup('{{ project.video }}'); return false;">{% if project.video %}
                {{ project.video}}
                {% else %}
                No video
                {% endif %}</td>
              <td class="py-2 px-4 border-b text-center flex justify-center space-x-2">
                <!-- Edit Button -->
                <a href="{% url "add_experiences" %}">
                <button title="Edit" class="text-blue-600 hover:text-blue-800">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5M18.5 2.5a2.121 2.121 0 113 3L12 15l-4 1 1-4 9.5-9.5z" />
                  </svg>
                </button>
              </a>

                <!-- Delete Button -->
                <a href="{% url "delete_project" project.id %}">
                <button title="Delete" class="text-red-600 hover:text-red-800">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0H7m4-3h2a1 1 0 011 1v1H8V5a1 1 0 011-1z" />
                  </svg>
                </button>
              </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-gray-500">No experience added yet.</p>
  {% endif %}
</div>
</div>

    </div>

  </div>
<!-- Image Popup Modal -->
<div id="imagePopupModal" style="display:none; position:fixed; top:50%; left:50%;
transform:translate(-50%, -50%); background:white; padding:10px; box-shadow:0 4px 8px rgba(0,0,0,0.2); 
z-index:1000; max-width:90%; max-height:90%;">
  <span onclick="closeImagePopup()" style="position:absolute; top:5px; right:10px; cursor:pointer; font-size:24px;">&times;</span>
  <img id="popupImage" src="" alt="Media Preview" style="max-width:100%; max-height:80vh; display:block; margin:auto;" />
</div>

<!-- Dark background overlay -->
<div id="imagePopupBackdrop" onclick="closeImagePopup()" style="display:none; position:fixed; top:0; left:0;
width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999;"></div>


  <script>
    function showSection(sectionId) {
      const sections = document.querySelectorAll('.content-section');
      sections.forEach(section => {
        section.classList.add('hidden');
      });
      document.getElementById(sectionId).classList.remove('hidden');
    }
    function openImagePopup(imageUrl) {
    document.getElementById('popupImage').src = imageUrl;
    document.getElementById('imagePopupModal').style.display = 'block';
    document.getElementById('imagePopupBackdrop').style.display = 'block';
  }

  function closeImagePopup() {
    document.getElementById('imagePopupModal').style.display = 'none';
    document.getElementById('imagePopupBackdrop').style.display = 'none';
    document.getElementById('popupImage').src = '';
  }
  </script>

</body>
</html>
